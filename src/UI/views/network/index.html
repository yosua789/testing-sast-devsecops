{%- extends "layout/base.html" -%}
{%- block content -%}


<div class="container-fluid py-4">
    <div action="">
        <div class="row my-4">
            <div class="col-lg-12 col-md-12 mb-md-0 mb-4">
                <div class="card">
                    <div class="card-header pb-0">
                        <div class="row">
                            <div class="col-lg-6 col-7">
                                <h6>Setting IP Address</h6>
                            </div>
                        </div>
                    </div>
                    <div class="card-body px-4 pb-2 mb-5">
                        <div class="form-check px-3">
                            <input class="form-check-input" type="checkbox" value="" id="dhcp" name="dhcp"
                                onchange="checkboxChange()">
                            <label class="form-check-label" for="dhcp">
                                DHCP
                            </label>
                        </div>
                        <div class="mb-3" style="width: 35%;">
                            <label for="level" class="form-label">Interface</label>
                            <select class="form-select form-control" aria-label="Default select example"
                                id="interfaceInput" name="interface" id="level">
                                <option selected disabled>Choose Interface</option>

                            </select>
                        </div>
                        <div class="mb-3" style="width: 35%;">
                            <label for="ipAddress" class="form-label">IP Addrress</label><br>
                            <input type="text" class="form-control" name="ip" id="ipInput">
                        </div>
                        <div class="mb-3" style="width: 35%;">
                            <label for="gateway" class="form-label">Default Gateway</label><br>
                            <input type="text" class="form-control" name="gateway" id="gatewayInput">
                        </div>
                        <div class="mb-3" style="width: 35%;">
                            <label for="gateway" class="form-label">Netmask</label><br>
                            <input type="text" class="form-control" name="netmask" id="netmaskinput">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <div class="row my-4">
            <div class="col-lg-12 col-md-12 mb-md-0 mb-4">
                <div class="card">
                    <div class="card-header pb-0">
                        <div class="row">
                            <div class="col-lg-6 col-7">
                                <h6>License</h6>
                            </div>
                        </div>
                    </div>

                    <div class="card-body px-4 pb-2">
                        <div class="form-check px-3 mb-3">
                            <input class="form-check-input" type="checkbox" value="" id="vpn" name="vpn">
                            <label class="form-check-label" for="vpn">
                                Enable VPN
                            </label>
                        </div>
                        <div class="mb-3">
                            <label for="gateway" class="form-label">OpenVPN File</label><br>
                            <div class="form-group mb-5" style="width: 35%;">
                                <input type="file" name="vpnFile" class="file">
                                <div class="input-group col-xs-12 d-flex align-items-center">
                                    <input type="text" class="form-control input-lg" disabled
                                        placeholder="Upload Image">
                                    <span class="input-group-btn">
                                        <button class="browse btn input-lg my-0"><i
                                                class="glyphicon glyphicon-search"></i> Browse</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="d-flex justify-content-end">
            <button class="btn btn-primary" type="submit" id="SettingUpdateBtn">Save Changes</button>
        </div>
    </div>
</div>
</main>
{%- endblock -%}

{%- block extrajs -%}
<script>
    function checkboxChange() {
        var checkbox = document.getElementById("dhcp");
        if (checkbox.checked) {
            $('#ipInput').attr('disabled', 'disabled');
            $('#gatewayInput').attr('disabled', 'disabled');
            $('#netmaskinput').attr('disabled', 'disabled');


        } else {
            $('#ipInput').removeAttr('disabled');
            $('#gatewayInput').removeAttr('disabled');
            $('#netmaskinput').removeAttr('disabled');
        }

    }

    $(document).ready(function () {

        $.get('/api/v1/networkapi/interfaceData', function (res) {

            var select = $('#interfaceInput')
            $.each(res, function (index, value) {
                select.append($("<option>").val(value).text(value));
            });
        })



        $("#SettingUpdateBtn").click(function () {
            var ip = $('#ipInput').val()
            var gateway = $('#gatewayInput').val()
            var netmask = $('#netmaskinput').val()
            var interface = $('#interfaceInput').val()
            var checkbox = document.getElementById("dhcp");

            if (checkbox.checked) {
                var postData = new FormData()
                postData.append('interface', interface)

                $.ajax({
                    url: '/api/v1/networkapi/dhcp-on', // Replace with your API endpoint
                    type: 'POST',
                    data: postData,
                    processData: false, // Prevent jQuery from automatically processing the data
                    contentType: false, // Let the server handle the Content-Type
                    success: function (response) {
                        if (response.status == 200) {
                            alert('Dhcp is on')
                            // Reload the page after 5 seconds
                            setTimeout(function () {
                                location.reload();
                            }, 1000);
                        } else {
                            alert(response.message)
                        }
                    },
                    error: function (xhr, status, error) {
                        // Handle the error response
                        console.error(error);
                    }
                });
            } else {
                var postData = new FormData()

                postData.append('interface', interface)
                postData.append('ip', ip)
                postData.append('gateway', gateway)
                postData.append('netmask', netmask)

                $.ajax({
                    url: '/api/v1/networkapi/set-ip', // Replace with your API endpoint
                    type: 'POST',
                    data: postData,
                    processData: false, // Prevent jQuery from automatically processing the data
                    contentType: false, // Let the server handle the Content-Type
                    success: function (response) {  
                        if (response.status == 200) {
                            alert('Set Ip Success')
                            // Reload the page after 5 seconds
                            setTimeout(function () {
                                location.reload();
                            }, 1000);
                        } else {
                            alert(response.message)
                        }
                    },
                    error: function (xhr, status, error) {
                        // Handle the error response
                        console.error(error);
                    }
                });
            }

        });

    });




    $(document).on('click', '.browse', function () {
        var file = $(this).parent().parent().parent().find('.file');
        file.trigger('click');

    });
    $(document).on('change', '.file', function () {
        $(this).parent().find('.form-control').val($(this).val().replace(/C:\\fakepath\\/i, ''));

    });
</script>
{%- endblock -%}